<!DOCTYPE html>
<html>
<head>
  <title>mid.js sample page</title>
  <meta charset="utf-8"/>
<script src="./closure-primitives/base.js"></script>
<script src="./deps.js"></script>
<script>
  var USE_TYPEDARRAY = true;
  Object.keys(goog.dependencies_.nameToPath).forEach(function(name) {
    goog.require(name);
  });
  </script>
  <style>
    body {
      font: 18px Helvetica, arial, freesans, clean, sans-serif;
      padding-top: 100px;
      padding-bottom: 50px;
    }
    h1 {
      border-bottom: 2px solid #48f;
      padding: 5px;
      font-size: xx-large;
    }
    h2 {
      border-left: 0.5em solid #444;
      padding-left: 10px;
    }
    canvas {
      margin: 1em;
      border: 1px solid #888;
      padding: 0.5em;
      box-shadow: 5px 5px 6px #ccc;
      -webkit-box-shadow: 5px 5px 6px #ccc;
    }

    header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 80px;
      background-color: #48f;
      color: white;
      margin-bottom: 100px;
      text-shadow: 1px 1px 2px #444;
      box-shadow: 5px 5px 6px #ccc;
      -webkit-box-shadow: 5px 5px 6px #444;
    }

    footer {
      height: 40px;
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: #48f;
      color: white;
      text-shadow: 1px 1px 2px #444;
    }
  </style>
</head>

<script>
NodeList.prototype.forEach = Array.prototype.forEach;
window.addEventListener('DOMContentLoaded', function() {

  document.getElementById('file').addEventListener('change', onFileSelected, false);
  function onFileSelected(e) {
    var file = document.getElementById("file").files[0];

    handleFile(file);

    e.preventDefault();
  }

  document.addEventListener('drop', function(e) {
    var dt = e.dataTransfer;
    var files = dt.files;

    e.stopPropagation();
    e.preventDefault();

    handleFile(files[0]);
  }, false);

  function handleFile(file) {
    var reader = new FileReader();

    switch (file.name.slice(file.name.lastIndexOf('.')).toLowerCase()) {
      case '.zip':
        reader.onload = function(e) {
          var input = new Uint8Array(e.target.result);

          var parser = new Zlib.Unzip(input);
          var hoge = window.hoge = parser;

          console.log(parser.getFilenames());
        };
        reader.readAsArrayBuffer(file);
        break;
    }
  }
}, false);
</script>
<body>

<header>
<h1>mid.js debug page</h1>
</header>

<div id="tracks"></div>
<div id="samples"></div>

<button onclick='player.play();'>start</button>
<button onclick='player.stop();'>stop</button>
<button onclick='loadSample();'>load(XHR)</button>

<br/>

<input id="playerloop" type="checkbox" onchange="player.setLoop(this.checked);"/><label for="playerloop">Loop</label>
<input id="cc111loop" type="checkbox" onchange="player.setCC111Loop(this.checked);" /><label for="cc111loop">CC#111</label>
<input id="falcomloop" type="checkbox" onchange="player.setFalcomLoop(this.checked);" /><label for="falcomloop">Marker A-B (Ys2 Eternal)</label>
<input id="mfiloop" type="checkbox" onchange="player.setMFiLoop(this.checked);" /><label for="mfiloop">MFi</label>



<p>
  このページで使用している TO MAKE THE END OF BATTLE の MIDI ファイルは <a href="http://www.falcom.co.jp/download/midi/down_ysm.html">イース MIDI コレクション</a> ( Copyright &copy; Nihon Falcom Corporation ) のものを利用しています。
</p>

<footer>
  <input type="file" id="file" name="file" />
</footer>

</body>
</html>